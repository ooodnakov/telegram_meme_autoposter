{% set key = request.query_params.get('key') %}
{% set key_query = '&key=' ~ key if key else '' %}
{% if posts %}
<div class="row g-3">
    {% for p in posts %}
    <div class="col-sm-6 col-md-4">
        {% if p['items']|length > 1 %}
        <span class="badge bg-secondary mb-1">Group of {{ p['items']|length }}</span>
        {% endif %}
        {% for media in p['items'] %}
        {% if media.is_video %}
        <video class="img-fluid" controls src="{{ media.url }}"></video>
        {% elif media.is_image %}
        <img class="img-fluid" src="{{ media.url }}" alt="{{ alt_text }}" />
        {% endif %}
        {% endfor %}
        <div class="mt-2 d-flex flex-wrap gap-1">
            <form method="post" action="/action" data-bg="true">
                {% for media in p['items'] %}
                <input type="hidden" name="paths" value="{{ media.path }}" />
                {% endfor %}
                <input type="hidden" name="action" value="push" />
                <input type="hidden" name="origin" value="{{ origin }}" />
                <input type="hidden" name="key" value="{{ request.query_params.get('key') }}" />
                <button class="btn btn-sm btn-primary" type="submit">Push!</button>
            </form>
            <form method="post" action="/action" data-bg="true">
                {% for media in p['items'] %}
                <input type="hidden" name="paths" value="{{ media.path }}" />
                {% endfor %}
                <input type="hidden" name="action" value="schedule" />
                <input type="hidden" name="origin" value="{{ origin }}" />
                <input type="hidden" name="key" value="{{ request.query_params.get('key') }}" />
                <button class="btn btn-sm btn-secondary" type="submit">Schedule</button>
            </form>
            <form
                method="post"
                action="/action"
                data-bg="true"
                onsubmit="return confirm('Remove from batch?');"
            >
                {% for media in p['items'] %}
                <input type="hidden" name="paths" value="{{ media.path }}" />
                {% endfor %}
                <input type="hidden" name="action" value="remove_batch" />
                <input type="hidden" name="origin" value="{{ origin }}" />
                <input type="hidden" name="key" value="{{ request.query_params.get('key') }}" />
                <button class="btn btn-sm btn-danger" type="submit">Remove</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="alert alert-info" role="alert">{{ empty_message }}</div>
{% endif %}
{% if total_pages > 1 %}
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-3">
        <li class="page-item {% if page == 1 %}disabled{% endif %}">
            {% if page == 1 %}
            <span class="page-link">Previous</span>
            {% else %}
            <a class="page-link"
               hx-get="/batch?page={{ page - 1 }}{{ key_query }}"
               hx-target="#batch-grid"
               hx-swap="innerHTML"
               href="/batch?page={{ page - 1 }}{{ key_query }}">Previous</a>
            {% endif %}
        </li>
        <li class="page-item disabled">
            <span class="page-link">Page {{ page }} of {{ total_pages }}</span>
        </li>
        <li class="page-item {% if page == total_pages %}disabled{% endif %}">
            {% if page == total_pages %}
            <span class="page-link">Next</span>
            {% else %}
            <a class="page-link"
               hx-get="/batch?page={{ page + 1 }}{{ key_query }}"
               hx-target="#batch-grid"
               hx-swap="innerHTML"
               href="/batch?page={{ page + 1 }}{{ key_query }}">Next</a>
            {% endif %}
        </li>
    </ul>
</nav>
{% endif %}
