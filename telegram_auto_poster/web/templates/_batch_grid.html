{% if posts %}
<div class="row g-3">
    {% for p in posts %}
    {% set batch_idx = loop.index0 %}
    <div class="col-sm-6 col-md-4">
        {% if p['items']|length > 1 %}
        <span class="badge bg-secondary mb-1">{{ _('Group of {n}').format(n=p['items']|length) }}</span>
        {% endif %}
        {% for media in p['items'] %}
        {% if media.is_video %}
        <video class="img-fluid" controls src="{{ media.url }}"></video>
        {% elif media.is_image %}
        <img class="img-fluid" src="{{ media.url }}" alt="{{ alt_text }}" />
        {% endif %}
        {% endfor %}
        <div class="mt-2 d-flex flex-wrap gap-1">
            <form method="post" action="/action" data-bg="true">
                {% for media in p['items'] %}
                <input type="hidden" name="paths" value="{{ media.path }}" />
                {% endfor %}
                <input type="hidden" name="action" value="push" />
                <input type="hidden" name="origin" value="{{ origin }}" />
                <button class="btn btn-sm btn-primary" type="submit">{{ _('Push!') }}</button>
            </form>
            <form method="post" action="/action" data-bg="true">
                {% for media in p['items'] %}
                <input type="hidden" name="paths" value="{{ media.path }}" />
                {% endfor %}
                <input type="hidden" name="action" value="schedule" />
                <input type="hidden" name="origin" value="{{ origin }}" />
                <button class="btn btn-sm btn-secondary" type="submit">{{ _('Schedule') }}</button>
            </form>
            <button
                class="btn btn-sm btn-outline-secondary"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#manual-schedule-{{ batch_idx }}"
                aria-expanded="false"
                aria-controls="manual-schedule-{{ batch_idx }}"
            >
                {{ _('Manual Schedule') }}
            </button>
            <form
                method="post"
                action="/action"
                data-bg="true"
                onsubmit="return confirm('{{ _('Remove from batch?') }}');"
            >
                {% for media in p['items'] %}
                <input type="hidden" name="paths" value="{{ media.path }}" />
                {% endfor %}
                <input type="hidden" name="action" value="remove_batch" />
                <input type="hidden" name="origin" value="{{ origin }}" />
                <button class="btn btn-sm btn-danger" type="submit">{{ _('Remove') }}</button>
            </form>
            <div class="collapse w-100" id="manual-schedule-{{ batch_idx }}">
                <form
                    method="post"
                    action="/batch/manual_schedule"
                    data-bg="true"
                    class="mt-2 d-flex flex-wrap gap-2 align-items-center"
                >
                    {% for media in p['items'] %}
                    <input type="hidden" name="paths" value="{{ media.path }}" />
                    {% endfor %}
                    <input type="hidden" name="origin" value="{{ origin }}" />
                    <input
                        type="text"
                        name="scheduled_at"
                        class="form-control form-control-sm datetime-picker"
                        placeholder="{{ _('YYYY-MM-DD HH:MM') }}"
                    />
                    <button class="btn btn-sm btn-success" type="submit">{{ _('Save') }}</button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="alert alert-info" role="alert">{{ empty_message }}</div>
{% endif %}
{% if total_pages > 1 %}
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-3">
        <li class="page-item {% if page == 1 %}disabled{% endif %}">
            {% if page == 1 %}
            <span class="page-link">{{ _('Previous') }}</span>
            {% else %}
            <a class="page-link"
               hx-get="/batch?page={{ page - 1 }}"
               hx-target="#batch-grid"
               hx-swap="innerHTML"
               href="/batch?page={{ page - 1 }}">{{ _('Previous') }}</a>
            {% endif %}
        </li>
        <li class="page-item disabled">
            <span class="page-link">{{ _("Page {page} of {total_pages}").format(page=page, total_pages=total_pages) }}</span>
        </li>
        <li class="page-item {% if page == total_pages %}disabled{% endif %}">
            {% if page == total_pages %}
            <span class="page-link">{{ _('Next') }}</span>
            {% else %}
            <a class="page-link"
               hx-get="/batch?page={{ page + 1 }}"
               hx-target="#batch-grid"
               hx-swap="innerHTML"
               href="/batch?page={{ page + 1 }}">{{ _('Next') }}</a>
            {% endif %}
        </li>
    </ul>
</nav>
{% endif %}
