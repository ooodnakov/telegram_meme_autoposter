{% extends "base.html" %}
{% block content %}
{% set query_suffix = '?page=' ~ page %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="m-0">{{ _('Batch') }}</h1>
    <a class="btn btn-sm btn-outline-secondary" href="/batch{{ query_suffix }}">{{ _('Refresh') }}</a>
</div>
{% if posts %}
{% set ns = namespace(paths=[]) %}
{% for post in posts %}
    {% for media in post['items'] %}
        {% set ns.paths = ns.paths + [media.path] %}
    {% endfor %}
{% endfor %}
<form
    method="post"
    action="/batch/send"
    onsubmit="return confirm('{{ _('Send whole batch?') }}');"
>
    <button class="btn btn-primary btn-lg w-100 mb-2" type="submit">
        {{ _('Send Batch') }}
    </button>
</form>
<button
    class="btn btn-outline-secondary w-100 mb-3"
    type="button"
    data-bs-toggle="collapse"
    data-bs-target="#manual-schedule-batch"
    aria-expanded="false"
    aria-controls="manual-schedule-batch"
>
    {{ _('Manual Schedule Batch') }}
</button>
<div class="collapse" id="manual-schedule-batch">
    <form
        method="post"
        action="/batch/manual_schedule"
        data-bg="true"
        class="card card-body mb-3 gap-2"
    >
        {% for path in ns.paths %}
        <input type="hidden" name="paths" value="{{ path }}" />
        {% endfor %}
        <input type="hidden" name="origin" value="batch" />
        <label class="form-label" for="manual-schedule-batch-input">{{ _('Start time') }}</label>
        <div class="d-flex flex-column flex-sm-row gap-2">
            <input
                id="manual-schedule-batch-input"
                type="text"
                name="scheduled_at"
                class="form-control form-control-sm datetime-picker"
                placeholder="{{ _('YYYY-MM-DD HH:MM') }}"
            />
            <button class="btn btn-sm btn-success" type="submit">{{ _('Save') }}</button>
        </div>
    </form>
</div>
{% endif %}
<div id="batch-grid">
    {% set origin = "batch" %}
    {% set alt_text = _('batch item') %}
    {% set empty_message = _('Batch is empty.') %}
    {% include "_batch_grid.html" %}
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js" integrity="sha256-IFiMwO33n2hRYI42V2B+K42LdwpD/LSJSgLzQ6G6Gqg=" crossorigin="anonymous"></script>
<script>
flatpickr(".datetime-picker", {enableTime: true, dateFormat: "{{ datetime_format_js }}"});
</script>
{% endblock %}
