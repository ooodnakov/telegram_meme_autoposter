{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="m-0">Queued Media</h1>
    {% set key = request.query_params.get('key') %}
    {% set key_query = '?key=' ~ key if key else '' %}
    <a class="btn btn-sm btn-outline-secondary" href="/queue{{ key_query }}">Refresh</a>
    
</div>
{% if posts %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">File Path</th>
                <th scope="col">Scheduled Time</th>
                <th scope="col">Preview</th>
            </tr>
        </thead>
        <tbody>
            {% for p in posts %}
            <tr>
                <td>{{ p.path }}</td>
                <td>{{ p.ts }}</td>
                <td>
                    <div class="d-flex align-items-center gap-2 flex-wrap">
                        <button class="btn btn-sm btn-primary" type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#preview-{{ loop.index0 }}"
                                aria-expanded="false"
                                aria-controls="preview-{{ loop.index0 }}">
                            Toggle Preview
                        </button>
                        <form method="post" action="/queue/unschedule" data-bg="true" onsubmit="return confirm('Unschedule this item?');">
                            <input type="hidden" name="path" value="{{ p.path }}" />
                            <input type="hidden" name="key" value="{{ request.query_params.get('key') }}" />
                            <button class="btn btn-sm btn-danger" type="submit">Unschedule</button>
                        </form>
                    </div>
                    <div class="collapse mt-2" id="preview-{{ loop.index0 }}">
                        {% if p.is_video %}
                            <video class="queue-video" controls preload="none" playsinline style="max-width: 220px; max-height: 180px;">
                                <source src="{{ p.url }}" {% if p.mime %}type="{{ p.mime }}"{% endif %} />
                                Your browser does not support the video tag.
                            </video>
                        {% elif p.is_image %}
                            <img src="{{ p.url }}" loading="lazy" class="img-fluid" style="max-width: 220px; max-height: 180px; object-fit: contain;" alt="preview">
                        {% else %}
                            <a href="{{ p.url }}" target="_blank" rel="noopener noreferrer">Open</a>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info" role="alert">
    No media scheduled.
</div>
{% endif %}
{% endblock %}
