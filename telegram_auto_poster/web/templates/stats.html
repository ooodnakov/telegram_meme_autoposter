{% extends "base.html" %}
{% block content %}
<h1>Analytics</h1>
<div class="row">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h2>Last 24 Hours</h2>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">Media Received: <span class="badge bg-primary rounded-pill">{{ daily.media_received }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Processed: <span class="badge bg-primary rounded-pill">{{ daily.photos_processed }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Processed: <span class="badge bg-primary rounded-pill">{{ daily.videos_processed }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Approved: <span class="badge bg-success rounded-pill">{{ daily.photos_approved }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Approved: <span class="badge bg-success rounded-pill">{{ daily.videos_approved }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Rejected: <span class="badge bg-danger rounded-pill">{{ daily.photos_rejected }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Rejected: <span class="badge bg-danger rounded-pill">{{ daily.videos_rejected }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Batches Sent: <span class="badge bg-info rounded-pill">{{ daily.batch_sent }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Approval Rate: <span class="badge bg-secondary rounded-pill">{{ '%.1f'|format(approval_24h) }}%</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Success Rate: <span class="badge bg-secondary rounded-pill">{{ '%.1f'|format(success_24h) }}%</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Errors: <span class="badge bg-warning text-dark rounded-pill">{{ daily_errors }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Busiest Hour: <span class="badge bg-secondary rounded-pill">{{ busiest_hour }} ({{ busiest_count }} events)</span></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h2>Performance</h2>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">Avg Photo Processing: <span class="badge bg-primary rounded-pill">{{ '%.2f'|format(perf.avg_photo_processing_time) }}s</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Avg Video Processing: <span class="badge bg-primary rounded-pill">{{ '%.2f'|format(perf.avg_video_processing_time) }}s</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Avg Upload: <span class="badge bg-info rounded-pill">{{ '%.2f'|format(perf.avg_upload_time) }}s</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Avg Download: <span class="badge bg-info rounded-pill">{{ '%.2f'|format(perf.avg_download_time) }}s</span></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h2>All-Time Totals</h2>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Processed: <span class="badge bg-primary rounded-pill">{{ total.photos_processed }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Processed: <span class="badge bg-primary rounded-pill">{{ total.videos_processed }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Approved: <span class="badge bg-success rounded-pill">{{ total.photos_approved }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Approved: <span class="badge bg-success rounded-pill">{{ total.videos_approved }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Rejected: <span class="badge bg-danger rounded-pill">{{ total.photos_rejected }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Rejected: <span class="badge bg-danger rounded-pill">{{ total.videos_rejected }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Batches Sent: <span class="badge bg-info rounded-pill">{{ total.batch_sent }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Approval Rate: <span class="badge bg-secondary rounded-pill">{{ '%.1f'|format(approval_total) }}%</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Total Errors: <span class="badge bg-warning text-dark rounded-pill">{{ total_errors }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">List Operations: <span class="badge bg-secondary rounded-pill">{{ total.list_operations }}</span></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="row mt-4">
    <div class="col-md-6">
        <canvas id="daily-activity"></canvas>
    </div>
    <div class="col-md-6">
        <canvas id="error-breakdown"></canvas>
    </div>
</div>
<script>
const dailyCtx = document.getElementById('daily-activity').getContext('2d');
new Chart(dailyCtx, {
    type: 'bar',
    data: {
        labels: ['Photos Approved', 'Videos Approved', 'Photos Rejected', 'Videos Rejected'],
        datasets: [{
            label: 'Last 24h',
            data: [
                {{ daily.photos_approved }},
                {{ daily.videos_approved }},
                {{ daily.photos_rejected }},
                {{ daily.videos_rejected }}
            ],
            backgroundColor: ['#198754', '#198754', '#dc3545', '#dc3545']
        }]
    },
    options: {responsive: true}
});
const errorCtx = document.getElementById('error-breakdown').getContext('2d');
new Chart(errorCtx, {
    type: 'pie',
    data: {
        labels: ['Processing', 'Storage', 'Telegram'],
        datasets: [{
            data: [
                {{ daily.processing_errors }},
                {{ daily.storage_errors }},
                {{ daily.telegram_errors }}
            ],
            backgroundColor: ['#ffc107', '#0dcaf0', '#6610f2']
        }]
    },
    options: {responsive: true}
});
</script>
{% endblock %}
