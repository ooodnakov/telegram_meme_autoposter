{% extends "base.html" %}
{% block content %}
<h1>Analytics</h1>
<div class="row">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h2>Last 24 Hours</h2>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">Media Received: <span class="badge bg-primary rounded-pill">{{ daily.media_received }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Processed: <span class="badge bg-primary rounded-pill">{{ daily.photos_processed }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Processed: <span class="badge bg-primary rounded-pill">{{ daily.videos_processed }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Approved: <span class="badge bg-success rounded-pill">{{ daily.photos_approved }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Approved: <span class="badge bg-success rounded-pill">{{ daily.videos_approved }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Rejected: <span class="badge bg-danger rounded-pill">{{ daily.photos_rejected }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Rejected: <span class="badge bg-danger rounded-pill">{{ daily.videos_rejected }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Batches Sent: <span class="badge bg-info rounded-pill">{{ daily.batch_sent }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Approval Rate: <span class="badge bg-secondary rounded-pill">{{ '%.1f'|format(approval_24h) }}%</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Success Rate: <span class="badge bg-secondary rounded-pill">{{ '%.1f'|format(success_24h) }}%</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Errors: <span class="badge bg-warning text-dark rounded-pill">{{ daily_errors }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Busiest Hour: <span class="badge bg-secondary rounded-pill">{{ busiest_hour }} ({{ busiest_count }} events)</span></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h2>Performance</h2>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">Avg Photo Processing: <span class="badge bg-primary rounded-pill">{{ '%.2f'|format(perf.avg_photo_processing_time) }}s</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Avg Video Processing: <span class="badge bg-primary rounded-pill">{{ '%.2f'|format(perf.avg_video_processing_time) }}s</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Avg Upload: <span class="badge bg-info rounded-pill">{{ '%.2f'|format(perf.avg_upload_time) }}s</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Avg Download: <span class="badge bg-info rounded-pill">{{ '%.2f'|format(perf.avg_download_time) }}s</span></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h2>All-Time Totals</h2>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Processed: <span class="badge bg-primary rounded-pill">{{ total.photos_processed }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Processed: <span class="badge bg-primary rounded-pill">{{ total.videos_processed }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Approved: <span class="badge bg-success rounded-pill">{{ total.photos_approved }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Approved: <span class="badge bg-success rounded-pill">{{ total.videos_approved }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Photos Rejected: <span class="badge bg-danger rounded-pill">{{ total.photos_rejected }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Videos Rejected: <span class="badge bg-danger rounded-pill">{{ total.videos_rejected }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Batches Sent: <span class="badge bg-info rounded-pill">{{ total.batch_sent }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Approval Rate: <span class="badge bg-secondary rounded-pill">{{ '%.1f'|format(approval_total) }}%</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Total Errors: <span class="badge bg-warning text-dark rounded-pill">{{ total_errors }}</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">List Operations: <span class="badge bg-secondary rounded-pill">{{ total.list_operations }}</span></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h2>Daily Approvals vs Rejections (24h)</h2>
            </div>
            <div class="card-body">
                <canvas
                    id="daily-activity"
                    data-photos-approved="{{ daily.photos_approved }}"
                    data-videos-approved="{{ daily.videos_approved }}"
                    data-photos-rejected="{{ daily.photos_rejected }}"
                    data-videos-rejected="{{ daily.videos_rejected }}"
                ></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h2>Error Breakdown (24h)</h2>
            </div>
            <div class="card-body">
                <canvas
                    id="error-breakdown"
                    data-processing-errors="{{ daily.processing_errors }}"
                    data-storage-errors="{{ daily.storage_errors }}"
                    data-telegram-errors="{{ daily.telegram_errors }}"
                ></canvas>
            </div>
        </div>
    </div>
</div>
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h2>Performance Metrics (Avg Seconds)</h2>
            </div>
            <div class="card-body">
                <canvas
                    id="performance-metrics"
                    data-avg-photo-processing-time="{{ '%.2f'|format(perf.avg_photo_processing_time) }}"
                    data-avg-video-processing-time="{{ '%.2f'|format(perf.avg_video_processing_time) }}"
                    data-avg-upload-time="{{ '%.2f'|format(perf.avg_upload_time) }}"
                    data-avg-download-time="{{ '%.2f'|format(perf.avg_download_time) }}"
                ></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h2>All-Time Activity</h2>
            </div>
            <div class="card-body">
                <canvas
                    id="total-activity"
                    data-photos-approved="{{ total.photos_approved }}"
                    data-videos-approved="{{ total.videos_approved }}"
                    data-photos-rejected="{{ total.photos_rejected }}"
                    data-videos-rejected="{{ total.videos_rejected }}"
                ></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/charts.js?v4"></script>
{% endblock %}
